--Criando PROCEDURE com parametro
CREATE PROCEDURE uSP_INSERT_FUNCAO
(@FUNCAO VARCHAR(100))
AS
BEGIN
	INSERT INTO FUNCAO
	VALUES (@FUNCAO)
END


--Executando PROCEDURE
EXECUTE uSP_INSERT_FUNCAO 'Diretor'

EXECUTE uSP_INSERT_FUNCAO @FUNCAO = 'CEO'

--Verificando os dados na tabela função
SELECT  * FROM FUNCAO
go


--CRIANDO PROCEDURE sem parametro para chamar uma consulta
CREATE PROCEDURE uSP_FUNC_POR_FUNCAO
AS
BEGIN
	SELECT  
		F.MATRICULA AS 'MATRICULA FUNCIONARIO',
		F.NOME AS 'NOME FUNCIONARIO',
		F.STATUS_FUNC AS 'STATUS FUNCIONARIO',
		FUN.DESCRICAO AS 'FUNÇÃO FUNCIONARIO'
	FROM FUNCIONARIO F 
		INNER JOIN FUNCAO AS FUN
			ON (F.CODFUNCAO = FUN.CODIGO)
			
END

--chamando a procedure de 3 maneiras diferentes

exec uSP_FUNC_POR_FUNCAO

execute uSP_FUNC_POR_FUNCAO

uSP_FUNC_POR_FUNCAO

go


--CRIANDO PROCEDURE com parametro para chamar uma consulta.
CREATE PROCEDURE uSP_FUNC_POR_FUNCAO_2
(@FUNCAO VARCHAR(100)
)
AS
BEGIN
	SELECT  
		F.MATRICULA AS 'MATRICULA FUNCIONARIO',
		F.NOME AS 'NOME FUNCIONARIO',
		F.STATUS_FUNC AS 'STATUS FUNCIONARIO',
		FUN.DESCRICAO AS 'FUNÇÃO FUNCIONARIO'
	FROM FUNCIONARIO F 
		INNER JOIN FUNCAO AS FUN
			ON (F.CODFUNCAO = FUN.CODIGO)
END

-- ALTERANDO PROCEDURE PARA COLOCAR CLAUSULA WHERE
ALTER PROCEDURE uSP_FUNC_POR_FUNCAO_2
(@FUNCAO VARCHAR(100)
)
AS
BEGIN
	SELECT  
		F.MATRICULA AS 'MATRICULA FUNCIONARIO',
		F.NOME AS 'NOME FUNCIONARIO',
		F.STATUS_FUNC AS 'STATUS FUNCIONARIO',
		FUN.DESCRICAO AS 'FUNÇÃO FUNCIONARIO'
	FROM FUNCIONARIO F 
		INNER JOIN FUNCAO AS FUN
			ON (F.CODFUNCAO = FUN.CODIGO)
	WHERE FUN.DESCRICAO = @FUNCAO
END


--executando procedure após alteração
execute uSP_FUNC_POR_FUNCAO_2 'ANALISTA jr'


-- ALTERANDO PROCEDURE PARA COLOCAR UM NOVO PARAMETRO E UMA NOVA CONDIÇÃO NO WHERE
ALTER PROCEDURE uSP_FUNC_POR_FUNCAO_2
(@FUNCAO VARCHAR(100),
@STATUS VARCHAR(10)
)
AS
BEGIN
	SELECT  
		F.MATRICULA AS 'MATRICULA FUNCIONARIO',
		F.NOME AS 'NOME FUNCIONARIO',
		F.STATUS_FUNC AS 'STATUS FUNCIONARIO',
		FUN.DESCRICAO AS 'FUNÇÃO FUNCIONARIO'
	FROM FUNCIONARIO F 
		INNER JOIN FUNCAO AS FUN
			ON (F.CODFUNCAO = FUN.CODIGO)
	WHERE FUN.DESCRICAO = @FUNCAO AND F.STATUS_FUNC = @STATUS
END


--executando procedure após alteração
execute uSP_FUNC_POR_FUNCAO_2 'ANALISTA jr', 'ATIVO'

-- apagando procedure
drop procedure uSP_FUNC_POR_FUNCAO_2